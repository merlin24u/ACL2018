<project name="ACL2018_Napoleon" default="compile" basedir=".">
    <description>Builds, tests, and runs the project Toucan.</description>
	
	<!-- Nom du jar --> 
    <property name="jar.name" value="${ant.project.name}"/>
	
	<!-- Chemin des dossiers -->
	<property name="source.dir" value=".\src"/>
	<property name="lib.dir" value="${source.dir}\lib"/>
	<property name="resource.dir" value="${source}\res"/>
	<property name="test.dir" value="${source.dir}\test"/>
	
	<property name="build.dir" value="${source.dir}\bin"/>
	<property name="class.dir" value="${build.dir}\classes"/>
	<property name="jar.dir" value="${build.dir}\jar"/>
	<property name="test.report.dir" value="${build.dir}\testrep"/>
	
	<!-- Classe principale -->
	<property name="main-class" value="start.Main" />
	
	<!-- Chemin vers le jar de junit -->
	<path id="classpath.test">
	    <pathelement location="${lib.dir}/junit-4.12.jar"/>
	  </path>
	
	
	<target name="main" depends="clean,run" />
	<target name="clean-build" depends="clean,jar" />

	<!-- Execution du jar -->
	<target name="run" depends="jar" description="Execute jar.">
		<echo message="execution du jar" />
		<java jar="${jar.dir}/${jar.name}.jar" fork="true"/>	
	</target>

	<!-- Creation du jar -->
	<target name="jar" depends="compile" description="Jar creation."  >
		<echo message="crÃ©ation du jar" />
		<mkdir dir="${jar.dir}" />
		<jar destfile="${jar.dir}/${jar.name}.jar" basedir="${build.dir}">
			<manifest>
				<attribute name="Main-Class" value="${main-class}"/>
			</manifest>
		</jar>
	</target>
	
	<!-- Execution des tests JUnit -->
	<target name="junit" depends="compile">
		<mkdir dir="${test.report.dir}"/>
		<junit printsummary="yes" fork="yes" haltonfailure="off">
			 <classpath>
			    <path refid="classpath.test"/>
			  </classpath>
			<formatter type="plain"/>
			
			<!-- Same with batch testing -->
			<batchtest fork="yes" todir="${test.report.dir}">
				<fileset dir="${class.dir}">
					<include name="acl/*Test.class" />
				</fileset>
			</batchtest>
		</junit>
	</target>
	
	<!-- Compilation des sources -->
	<target name="compile"
	        description="Compile project." >
	    <echo message="compilation du code" />
		<mkdir dir="${build.dir}" />
		<mkdir dir="${class.dir}" />
		<mkdir dir="${test.dir}" />
		<javac srcdir="${source.dir}" destdir="${class.dir}">
			<exclude name="${test.dir}\*"/>
		</javac>
		<javac srcdir="${test.dir}" destdir="${class.dir}" />
	</target>
		
	<!-- Nettoyage des fichiers du dossier build -->
	<target name="clean" description="Clean build.">
		<echo message="nettoyage du dossier de build" />
		<delete dir="${build.dir}"/>
	</target>
	<target name="clean-jar" description="Clean jar.">
		<echo message="nettoyage du dossier de jar" />
		<delete file="${jar.dir}/${jar.name}.jar"/>
	</target>
	<target name="clean-compile" description="Clean compile.">
		<delete>
			<fileset dir="${class.dir}" includes="**/*.class" />
		</delete>
	</target>
	
	
	
	
	
</project>
